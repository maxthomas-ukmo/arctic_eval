# ESMValTool
# recipe_arctic_ocean.yml
---
documentation:
  title: Arctic Ocean Diagnostics
  description: |
    Arctic Ocean diagnostics.

  authors:
    - koldunov_nikolay

  maintainer:
    - koldunov_nikolay

  references:
    - contact_authors

  projects:
    - trr181
    - applicate

# Model problems
datasets:
  - {dataset: HadGEM3-GC31-LL, project: CMIP6}
#  - {dataset: HadGEM3-GC31-MM, project: CMIP6}
#  - {dataset: HadGEM3-GC31-LL, project: CMIP6, mip: SImon, exp: historical, ensemble: r*i1p1f3, grid: gn}
#  - {dataset: HadGEM3-GC31-MM, project: CMIP6, mip: SImon, exp: historical, ensemble: r*i1p1f3, grid: gn}

preprocessors:

  extract_whole_arctic: &extract_whole_arctic_preprocessor
    extract_region: 
      start_longitude: 0
      end_longitude: 360
      start_latitude: 50
      end_latitude: 90
  
  whole_arctic_sum:
    <<: *extract_whole_arctic_preprocessor
    climate_statistics: 
      operator: mean
      period: month
    area_statistics:
      operator: sum
    multi_model_statistics:
      span: full
      statistics: [mean, min, max]
      groupby: [dataset]

  # monthly means for each gridcell in arctic
  arctic_gs_monthmean:
    # extract Arctic
    <<: *extract_whole_arctic_preprocessor
    # # get gridcell areas
    # derive:
    #   units: m2
    #   short_name: areacello
    #   long_name: Ocean Grid-Cell Area
    # take month means
    climate_statistics:
      operator: mean
      period: month
    # get ensemble statistics for single model
    multi_model_statistics:
      span: full
      statistics: [mean, min, max]
      groupby: [dataset]
    
  2D_map:
    extract_region:
      start_longitude: 0
      end_longitude: 360
      start_latitude: 0
      end_latitude: 90
    multi_model_statistics:
      span: full
      statistics: [mean]
      groupby: [dataset]

  timeseries_sum:
    extract_region:
      start_longitude: 0
      end_longitude: 360
      start_latitude: 65
      end_latitude: 90
    area_statistics:
      operator: sum
    multi_model_statistics:
      span: full
      statistics: [mean]
      groupby: [dataset]

  timeseries_gs:
    <<: *extract_whole_arctic_preprocessor
    # area_statistics:
    #   operator: sum
    multi_model_statistics:
      span: full
      statistics: [mean]
      groupby: [dataset]
      
    
diagnostics:
  seasonal_cycle:
    description: Seasonal cycle of integrated sea-ice area
    variables:
      siconc:
        mip: SImon
        exp: historical
        ensemble: r*i1p1f3
        grid: gn
        start_year: 1979
        end_year: 1982
        #preprocessor: whole_arctic_sum # this does the summing for the region passed to the preprocessor
        preprocessor: arctic_gs_monthmean # this excludes the sum
        #convert_units: 1e6 km2
        additional_datasets:
          -  {dataset: HadISST, project: OBS, mip: OImon, tier: 2, type: reanaly, version: 1, ensemble: '', grid: ''}
      areacello:
        mip: Ofx
        grid: gn
        exp: piControl
        ensemble: r1i1p1f1
        preprocessor: extract_whole_arctic
    scripts:
      seasonal_cycle:
        script: /home/users/max.thomas/projects/esmvaltool/development/diag_scripts/arctic_eval.py
        dummy_plot: False
        variables_to_plot: [siconc] #, sivol]
        model_datasets: [HadGEM3-GC31-LL] #, HadGEM3-GC31-MM]
        obs_datasets: [HadISST]
        regions: ['Arctic', 'EB', 'AB']

  maps:
    description: Maps of March and September sea-ice concentration
    variables:
      siconc:
        mip: SImon
        exp: historical
        ensemble: r*i1p1f3
        grid: gn
        start_year: 1979
        end_year: 1982
        #preprocessor: whole_arctic_sum # this does the summing for the region passed to the preprocessor
        preprocessor: 2D_map # this excludes the sum
        #convert_units: 1e6 km2
        additional_datasets:
          -  {dataset: HadISST, project: OBS, mip: OImon, tier: 2, type: reanaly, version: 1, ensemble: '', grid: ''}
    scripts:
      geo_map_march_sept:
        script: /home/users/max.thomas/projects/esmvaltool/development/diag_scripts/arctic_eval.py
        dummy_plot: False
        variables_to_plot: [siconc]
        regions: ['Arctic']
        model_datasets: [HadGEM3-GC31-LL] #, HadGEM3-GC31-MM]
        obs_datasets: [HadISST]
        months: [3, 9]        

  timeseries:
    description: Time series of integrated sea-ice area
    variables:
      siconc: 
        mip: SImon
        exp: historical
        ensemble: r*i1p1f3
        grid: gn
        start_year: 1979
        end_year: 2000
        preprocessor: timeseries_gs 
        additional_datasets:
          -  {dataset: HadISST, project: OBS, mip: OImon, tier: 2, type: reanaly, version: 1, ensemble: '', grid: ''}
      areacello:
          mip: Ofx
          grid: gn
          exp: piControl
          ensemble: r1i1p1f1
          preprocessor: extract_whole_arctic
    scripts:
      timeseries:
        script: /home/users/max.thomas/projects/esmvaltool/development/diag_scripts/arctic_eval.py
        dummy_plot: False
        variables_to_plot: [siconc]
        model_datasets: [HadGEM3-GC31-LL] #, HadGEM3-GC31-MM]
        obs_datasets: [] #[HadISST]
        regions: ['Arctic', 'EB', 'AB']
          
  region_plot:
    description: Regions used for subsetting
    variables:
      siconc: 
        mip: SImon
        exp: historical
        ensemble: r*i1p1f3
        grid: gn
        start_year: 1979
        end_year: 1980
        preprocessor: 2D_map # this does the summing for the region passed to the preprocessor
        additional_datasets:
          -  {dataset: HadISST, project: OBS, mip: OImon, tier: 2, type: reanaly, version: 1, ensemble: '', grid: ''}
    scripts:
      regions:
        script: /home/users/max.thomas/projects/esmvaltool/development/diag_scripts/arctic_eval.py
        dummy_plot: False
        variables_to_plot: [siconc]
        regions: ['EB', 'AB', 'Barents_sea']
        region_centers: [[85,0], [85, 180], [75, 40]]
        model_datasets: [HadGEM3-GC31-LL] #, HadGEM3-GC31-MM]
        obs_datasets: [HadISST]
